<%- include('partials/header') %>
<%- include('partials/nav', { activePage: 'edit', isLoggedIn: isLoggedIn }) %>

<div class="min-h-screen bg-gradient-to-br from-indigo-100 via-white to-indigo-50 flex flex-col items-center px-4 py-6 sm:px-6 lg:px-8">

    <!-- Page Heading -->
    <h1 class="text-3xl sm:text-4xl font-bold text-gray-800 mb-8 text-center">Edit Car Details</h1>

    <!-- Edit Car Form Container -->
    <div class="bg-white p-6 sm:p-8 rounded-xl shadow-lg w-full max-w-4xl">
        
        <!-- Back Button -->
        <div class="mb-6">
            <a href="/detail/<%= car._id %>" 
               class="inline-flex items-center px-4 py-2 bg-gray-600 text-white font-semibold rounded-lg shadow hover:bg-gray-700 transition duration-200">
                ‚Üê Back to Details
            </a>
        </div>

        <!-- Edit Form -->
        <form action="/editcar/<%= car._id %>" method="POST" enctype="multipart/form-data" class="space-y-6">
            
            <!-- Car Owner Name -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="Username" class="block text-sm font-medium text-gray-700 mb-2">Car Owner Name</label>
                    <input type="text" 
                           id="Username" 
                           name="Username" 
                           value="<%= car.Username %>"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200"
                           required>
                </div>

                <!-- Car Number/Engine No -->
                <div>
                    <label for="car_no" class="block text-sm font-medium text-gray-700 mb-2">Car Number/Engine No</label>
                    <input type="text" 
                           id="car_no" 
                           name="car_no" 
                           value="<%= car.car_no %>"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200"
                           required>
                </div>
            </div>

            <!-- Phone Number and Email -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="phonenumber" class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                    <input type="tel" 
                           id="phonenumber" 
                           name="phonenumber" 
                           value="<%= car.phonenumber %>"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200"
                           required>
                </div>

                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-2">Email (Optional)</label>
                    <input type="email" 
                           id="email" 
                           name="email" 
                           value="<%= car.email || '' %>"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200">
                </div>
            </div>

            <!-- PUC Dates -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="lastPUC" class="block text-sm font-medium text-gray-700 mb-2">Last PUC Date</label>
                    <input type="date" 
                           id="lastPUC" 
                           name="lastPUC" 
                           value="<%= car.lastPUC ? car.lastPUC.toISOString().split('T')[0] : '' %>"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200"
                           required>
                </div>

                <div>
                    <label for="nextPUC" class="block text-sm font-medium text-gray-700 mb-2">Next PUC Date</label>
                    <input type="date" 
                           id="nextPUC" 
                           name="nextPUC" 
                           value="<%= car.nextPUC ? car.nextPUC.toISOString().split('T')[0] : '' %>"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200"
                           readonly>
                    <p class="text-xs text-gray-500 mt-1">Automatically calculated (6 months from Last PUC)</p>
                </div>
            </div>

            <!-- Insurance Dates -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="lastInsurance" class="block text-sm font-medium text-gray-700 mb-2">Last Insurance Date</label>
                    <input type="date" 
                           id="lastInsurance" 
                           name="lastInsurance" 
                           value="<%= car.lastInsurance ? car.lastInsurance.toISOString().split('T')[0] : '' %>"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200"
                           required>
                </div>

                <div>
                    <label for="nextInsurance" class="block text-sm font-medium text-gray-700 mb-2">Next Insurance Date</label>
                    <input type="date" 
                           id="nextInsurance" 
                           name="nextInsurance" 
                           value="<%= car.nextInsurance ? car.nextInsurance.toISOString().split('T')[0] : '' %>"
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200"
                           readonly>
                    <p class="text-xs text-gray-500 mt-1">Automatically calculated (1 year from Last Insurance)</p>
                </div>
            </div>

            <!-- Car Image -->
            <div>
                <label for="carImage" class="block text-sm font-medium text-gray-700 mb-2">Car Image</label>
                
                <!-- Current Image Display -->
                <% if (car.image) { %>
                <div class="mb-4">
                    <p class="text-sm text-gray-600 mb-2">Current Image:</p>
                    <img src="<%= car.image %>" alt="Current Car Image" class="w-32 h-32 object-cover rounded-lg border border-gray-300">
                </div>
                <% } %>

                <!-- File Input -->
                <input type="file" 
                       id="carImage" 
                       name="carImage" 
                       accept="image/*"
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200">
                <p class="text-xs text-gray-500 mt-1">Choose a new image to replace the current one (optional)</p>
            </div>

            <!-- Submit Buttons -->
            <div class="flex flex-col sm:flex-row gap-4 pt-6">
                <button type="submit" 
                        class="flex-1 px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow hover:bg-indigo-700 focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 transition duration-200">
                    Update Car Details
                </button>
                
                <a href="/detail/<%= car._id %>" 
                   class="flex-1 px-6 py-3 bg-gray-300 text-gray-700 font-semibold rounded-lg shadow hover:bg-gray-400 focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition duration-200 text-center">
                    Cancel
                </a>
            </div>

        </form>
    </div>

</div>

<!-- Auto-calculate next dates script -->
<script>
    // Auto-calculate next PUC date (6 months from last PUC)
    document.getElementById('lastPUC').addEventListener('change', function() {
        const lastPUC = new Date(this.value);
        if (lastPUC) {
            const nextPUC = new Date(lastPUC);
            nextPUC.setMonth(nextPUC.getMonth() + 6);
            document.getElementById('nextPUC').value = nextPUC.toISOString().split('T')[0];
        }
    });

    // Auto-calculate next insurance date (1 year from last insurance)
    document.getElementById('lastInsurance').addEventListener('change', function() {
        const lastInsurance = new Date(this.value);
        if (lastInsurance) {
            const nextInsurance = new Date(lastInsurance);
            nextInsurance.setFullYear(nextInsurance.getFullYear() + 1);
            document.getElementById('nextInsurance').value = nextInsurance.toISOString().split('T')[0];
        }
    });
</script>

<%- include('partials/footer') %>