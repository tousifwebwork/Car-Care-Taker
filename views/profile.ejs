<%- include('partials/header') %>
<%- include('partials/nav',{ activePage: 'profile', isLoggedIn: isLoggedIn }) %>

<div id="top" class="min-h-screen bg-gradient-to-br from-indigo-100 via-white to-indigo-50 flex justify-center py-6 px-4 sm:py-12 sm:px-6 pt-20">
  <div class="w-full max-w-4xl bg-white shadow-2xl rounded-3xl p-6 sm:p-8">

    <!-- Profile Header -->
    <section id="profile-header" class="flex flex-col sm:flex-row items-center sm:items-start space-y-4 sm:space-y-0 sm:space-x-6 border-b border-gray-200 pb-4 sm:pb-6 mb-4 sm:mb-6">
      <div class="w-24 h-24 sm:w-28 sm:h-28 rounded-full overflow-hidden border-4 border-indigo-500 shadow-md flex items-center justify-center bg-indigo-100">
        <% if (logininfo.image) { %>
          <img src="<%= logininfo.image %>" class="w-full h-full object-cover" />
        <% } else { %>
          <div class="w-full h-full bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center text-2xl font-bold text-white">
            <%= (logininfo.fullName || logininfo.username).charAt(0).toUpperCase() %>
          </div>
        <% } %>
      </div>

      <div class="flex-1 text-center sm:text-left">
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-800"><%= logininfo.fullName || logininfo.username %></h1>
        <p class="text-gray-600 mt-1 text-sm sm:text-base">@<%= logininfo.username %></p>
        <p class="text-gray-700 mt-1 text-sm sm:text-base"><%= logininfo.email || "N/A" %></p>
      </div>

      <div>
        <a href="/editprofile" class="px-4 sm:px-5 py-2 bg-indigo-600 text-white rounded-lg shadow-lg hover:bg-indigo-700 transition-all text-sm sm:text-base font-medium">
          Edit Profile
        </a>
      </div>
    </section>

    <!-- Profile Info Cards -->
    <section id="profile-info" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8">
      <div class="bg-indigo-50 border border-indigo-200 p-4 sm:p-5 rounded-2xl text-center shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105 ">
        <div class="w-12 h-12 bg-indigo-500 rounded-lg flex items-center justify-center mx-auto mb-3">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
          </svg>
        </div>
        <p class="text-indigo-600 text-xs sm:text-sm uppercase tracking-wide font-semibold">Full Name</p>
        <p class="font-bold text-base sm:text-lg text-gray-800"><%= logininfo.fullName || "Not set" %></p>
      </div>

      <div class="bg-purple-50 border border-purple-200 p-4 sm:p-5 rounded-2xl text-center shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
        <div class="w-12 h-12 bg-purple-500 rounded-lg flex items-center justify-center mx-auto mb-3">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"/>
          </svg>
        </div>
        <p class="text-purple-600 text-xs sm:text-sm uppercase tracking-wide font-semibold">Username</p>
        <p class="font-bold text-base sm:text-lg text-gray-800">@<%= logininfo.username %></p>
      </div>

      <div class="bg-green-50 border border-green-200 p-4 sm:p-5 rounded-2xl text-center shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
        <div class="w-12 h-12 bg-green-500 rounded-lg flex items-center justify-center mx-auto mb-3">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
          </svg>
        </div>
        <p class="text-green-600 text-xs sm:text-sm uppercase tracking-wide font-semibold">Cars Registered</p>
        <p class="font-bold text-base sm:text-lg text-gray-800"><%= carinfo.length || "0" %></p>
      </div>

      <div class="bg-orange-50 border border-orange-200 p-4 sm:p-5 rounded-2xl text-center shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
        <div class="w-12 h-12 bg-orange-500 rounded-lg flex items-center justify-center mx-auto mb-3">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
        </div>
        <p class="text-orange-600 text-xs sm:text-sm uppercase tracking-wide font-semibold">Member Since</p>
        <p class="font-bold text-base sm:text-lg text-gray-800">
          <%= (logininfo.createdAt) ? new Date(logininfo.createdAt).toLocaleDateString() : 'N/A' %>
        </p>
      </div>

      <div class="bg-emerald-50 border border-emerald-200 p-4 sm:p-5 rounded-2xl text-center shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
        <div class="w-12 h-12 bg-emerald-500 rounded-lg flex items-center justify-center mx-auto mb-3">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <p class="text-emerald-600 text-xs sm:text-sm uppercase tracking-wide font-semibold">Active Policies</p>
        <p class="font-bold text-xl sm:text-2xl text-gray-800">
          <%= (carinfo && carinfo.filter(c => c.nextInsurance && new Date(c.nextInsurance) > new Date()).length) || '0' %>
        </p>
      </div>

      <div class="bg-blue-50 border border-blue-200 p-4 sm:p-5 rounded-2xl text-center shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
        <div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center mx-auto mb-3">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"/>
          </svg>
        </div>
        <p class="text-blue-600 text-xs sm:text-sm uppercase tracking-wide font-semibold">Email Address</p>
        <p class="font-bold text-sm sm:text-base text-gray-800 break-all"><%= logininfo.email || "Not provided" %></p>
      </div>

      <div class="bg-rose-50 border border-rose-200 p-4 sm:p-5 rounded-2xl text-center shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
        <div class="w-12 h-12 bg-rose-500 rounded-lg flex items-center justify-center mx-auto mb-3">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <p class="text-rose-600 text-xs sm:text-sm uppercase tracking-wide font-semibold">Expiring Soon</p>
        <p class="font-bold text-xl sm:text-2xl text-gray-800">
          <%= (carinfo && carinfo.filter(c => c.nextInsurance && new Date(c.nextInsurance) - new Date() <= 30 * 24 * 60 * 60 * 1000).length) || '0' %>
        </p>
      </div>

      <!-- Additional Profile Information -->
      <% if (logininfo.address) { %>
      <div class="bg-teal-50 border border-teal-200 p-4 sm:p-5 rounded-2xl text-center shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
        <div class="w-12 h-12 bg-teal-500 rounded-lg flex items-center justify-center mx-auto mb-3">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
          </svg>
        </div>
        <p class="text-teal-600 text-xs sm:text-sm uppercase tracking-wide font-semibold">Address</p>
        <p class="font-bold text-sm sm:text-base text-gray-800"><%= logininfo.address %></p>
      </div>
      <% } %>

      <% if (logininfo.phonenumber) { %>
      <div class="bg-cyan-50 border border-cyan-200 p-4 sm:p-5 rounded-2xl text-center shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
        <div class="w-12 h-12 bg-cyan-500 rounded-lg flex items-center justify-center mx-auto mb-3">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
          </svg>
        </div>
        <p class="text-cyan-600 text-xs sm:text-sm uppercase tracking-wide font-semibold">Phone Number</p>
        <p class="font-bold text-sm sm:text-base text-gray-800"><%= logininfo.phonenumber %></p>
      </div>
      <% } %>

      <% if (logininfo.gender) { %>
      <div class="bg-violet-50 border border-violet-200 p-4 sm:p-5 rounded-2xl text-center shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
        <div class="w-12 h-12 bg-violet-500 rounded-lg flex items-center justify-center mx-auto mb-3">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
          </svg>
        </div>
        <p class="text-violet-600 text-xs sm:text-sm uppercase tracking-wide font-semibold">Gender</p>
        <p class="font-bold text-sm sm:text-base text-gray-800"><%= logininfo.gender %></p>
      </div>
      <% } %>

      <% if (logininfo.dob) { %>
      <div class="bg-amber-50 border border-amber-200 p-4 sm:p-5 rounded-2xl text-center shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-105">
        <div class="w-12 h-12 bg-amber-500 rounded-lg flex items-center justify-center mx-auto mb-3">
          <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
        </div>
        <p class="text-amber-600 text-xs sm:text-sm uppercase tracking-wide font-semibold">Date of Birth</p>
        <p class="font-bold text-sm sm:text-base text-gray-800"><%= new Date(logininfo.dob).toLocaleDateString() %></p>
      </div>
      <% } %>
    </section>

    <!-- Cars List -->
    <section id="my-cars" class="mt-8">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-lg sm:text-xl font-semibold text-gray-800">My Cars</h2>
        <a href="/add" class="px-4 py-2 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700 transition-all">
          <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
          </svg>
          Add Car
        </a>
      </div>
      
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
        <% if (carinfo.length > 0) { %>
          <% carinfo.forEach(c => { %>
            <div class="bg-white border border-gray-200 rounded-2xl p-4 hover:shadow-lg transition-all duration-300 transform hover:scale-[1.02]">
              <div class="flex justify-between items-start mb-3">
                <div class="flex-1">
                  <h3 class="font-bold text-lg text-gray-900"><%= c.Username || "Unknown Car" %></h3>
                  <p class="text-indigo-600 font-semibold text-sm"><%= c.car_no %></p>
                </div>
                <div class="w-16 h-12 bg-gray-100 rounded-lg overflow-hidden">
                  <% if (c.image) { %>
                    <img src="<%= c.image %>" alt="Car" class="w-full h-full object-cover" />
                  <% } else { %>
                    <div class="w-full h-full flex items-center justify-center text-gray-400">
                      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                      </svg>
                    </div>
                  <% } %>
                </div>
              </div>
              
              <div class="grid grid-cols-2 gap-3 text-xs">
                <div class="bg-blue-50 p-2 rounded-lg">
                  <p class="text-blue-600 font-semibold">PUC Status</p>
                  <p class="text-gray-700">Expires: <%= c.nextPUC ? new Date(c.nextPUC).toLocaleDateString() : "N/A" %></p>
                  <% if (c.nextPUC) { %>
                    <% const daysLeft = Math.ceil((new Date(c.nextPUC) - new Date()) / (1000 * 60 * 60 * 24)); %>
                    <p class="<%= daysLeft <= 30 ? 'text-red-600' : daysLeft <= 60 ? 'text-yellow-600' : 'text-green-600' %> font-semibold">
                      <%= daysLeft > 0 ? daysLeft + ' days left' : 'Expired' %>
                    </p>
                  <% } %>
                </div>
                
                <div class="bg-green-50 p-2 rounded-lg">
                  <p class="text-green-600 font-semibold">Insurance</p>
                  <p class="text-gray-700">Expires: <%= c.nextInsurance ? new Date(c.nextInsurance).toLocaleDateString() : "N/A" %></p>
                  <% if (c.nextInsurance) { %>
                    <% const daysLeft = Math.ceil((new Date(c.nextInsurance) - new Date()) / (1000 * 60 * 60 * 24)); %>
                    <p class="<%= daysLeft <= 30 ? 'text-red-600' : daysLeft <= 60 ? 'text-yellow-600' : 'text-green-600' %> font-semibold">
                      <%= daysLeft > 0 ? daysLeft + ' days left' : 'Expired' %>
                    </p>
                  <% } %>
                </div>
              </div>
              
              <div class="flex justify-between items-center mt-3 pt-3 border-t border-gray-100">
                <a href="/detail/<%= c._id %>" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">
                  View Details →
                </a>
                <a href="/editcar/<%= c._id %>" class="text-gray-600 hover:text-gray-800 text-sm">
                  <svg class="w-4 h-4 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                  </svg>
                  Edit
                </a>
              </div>
            </div>
          <% }) %>
        <% } else { %>
          <div class="lg:col-span-2 text-center py-12">
            <div class="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-12 h-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
              </svg>
            </div>
            <h3 class="text-xl font-semibold text-gray-700 mb-2">No cars added yet</h3>
            <p class="text-gray-500 mb-6">Start by adding your first vehicle to track insurance and PUC renewals</p>
            <a href="/add" class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-all inline-flex items-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
              </svg>
              Add Your First Car
            </a>
          </div>
        <% } %>
      </div>
    </section>

  </div>
</div>

<!-- Enhanced Smooth Scrolling and Animation JavaScript -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Create and style scroll-to-top button
        let scrollToTopBtn = document.createElement('button');
        scrollToTopBtn.innerHTML = '↑';
        scrollToTopBtn.className = 'scroll-to-top';
        scrollToTopBtn.setAttribute('aria-label', 'Scroll to top');
        scrollToTopBtn.onclick = () => {
            window.scrollTo({ 
                top: 0, 
                behavior: 'smooth' 
            });
        };
        document.body.appendChild(scrollToTopBtn);

        // Show/hide scroll to top button based on scroll position
        function toggleScrollButton() {
            if (window.pageYOffset > 200) {
                scrollToTopBtn.classList.add('visible');
            } else {
                scrollToTopBtn.classList.remove('visible');
            }
        }

        // Throttled scroll listener for better performance
        let scrollTimeout;
        window.addEventListener('scroll', function() {
            if (scrollTimeout) {
                clearTimeout(scrollTimeout);
            }
            scrollTimeout = setTimeout(() => {
                toggleScrollButton();
            }, 10);
        });
        
        // Initial check
        toggleScrollButton();

        // Add smooth scrolling to all anchor links on the page
        const allAnchorLinks = document.querySelectorAll('a[href^="#"]');
        allAnchorLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                const href = this.getAttribute('href');
                if (href === '#' || href === '#top') {
                    e.preventDefault();
                    window.scrollTo({ 
                        top: 0, 
                        behavior: 'smooth' 
                    });
                    return;
                }
                
                const targetId = href.substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    e.preventDefault();
                    targetElement.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Add intersection observer for scroll-triggered animations
        const observerOptions = {
            threshold: 0.2,
            rootMargin: '0px 0px -10% 0px'
        };

        const elementObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('animate-fadeInUp');
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        // Add animation classes to profile sections
        const profileSections = document.querySelectorAll('#profile-header, #profile-info, #my-cars');
        const profileCards = document.querySelectorAll('.bg-indigo-50, .bg-purple-50, .bg-green-50, .bg-orange-50, .bg-emerald-50, .bg-blue-50, .bg-rose-50');
        
        [...profileSections, ...profileCards].forEach((element, index) => {
            element.style.opacity = '0';
            element.style.transform = 'translateY(30px)';
            element.style.transition = 'all 0.6s ease-out';
            element.style.transitionDelay = `${index * 0.1}s`;
            elementObserver.observe(element);
        });
        
        // Smooth scroll on page load
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });
</script>

<%- include('partials/footer') %>
